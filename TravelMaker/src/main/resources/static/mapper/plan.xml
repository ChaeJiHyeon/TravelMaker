<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project1.mybatis.PlanMapper">

    <select id="findMapX" resultType="String" parameterType="com.project1.order.PurchaseDto">
        SELECT mapX FROM station where region = #{region};
    </select>

    <select id="findMapY" resultType="String" parameterType="com.project1.order.PurchaseDto">
        SELECT mapY FROM station where region = #{region};
    </select>

    <select id="checkTicketA" resultType="Integer" parameterType="com.project1.order.OrderDto">
        SELECT count(ticketSerial) FROM ticket where ticketEndPoint = #{ticketEndPoint}
                                                 and ticketStartDate = #{startDate}
                                                 and ticketStartDateTime = #{startDateTime}
    </select>

    <select id="checkTicketB" resultType="Integer" parameterType="com.project1.order.OrderDto">
        SELECT count(ticketSerial) FROM ticket where ticketStartPoint = #{ticketEndPoint}
                                                 and ticketStartDate = #{endDate}
                                                 and ticketStartDateTime = #{endDateTime}
    </select>

    <select id="purchaseTicketA" resultType="com.project1.order.OrderDto" parameterType="com.project1.order.OrderDto">
        select ticketSerial from ticket where (ticketEndPoint = #{endPoint}
            and ticketStartDate = #{startDate}
            and ticketStartDateTime = #{startDateTime}) limit #{people}
    </select>

    <select id="purchaseTicketB" resultType="String" parameterType="com.project1.order.OrderDto">
        select ticketSerial from ticket where (ticketStartPoint = #{endPoint}
            and ticketStartDate = #{endDate}
            and ticketStartDateTime = #{endDateTime}) limit #{people}
    </select>

    <insert id="insertPurchase" parameterType="com.project1.order.PurchaseDto">
        insert into purchase (purchaseSerial, email, price, people, region, startDate, endDate, startDateTime, endDateTime)
        values (#{purchaseSerial}, #{email}, #{price}, #{people}, #{region}, #{startDate}, #{endDate}, #{startDateTime}, #{endDateTime})
    </insert>

    <update id="updateTicketA" parameterType="String">
        update ticket set ticketStatus = 1
        where ticketSerial = #{ticketSerial}
    </update>

    <update id="updateTicketB" parameterType="String">
        update ticket set ticketStatus = 1
        where ticketSerial = #{ticketSerial}
    </update>

</mapper>